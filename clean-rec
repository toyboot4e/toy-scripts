#!/usr/bin/env bash
#
# Run `cargo clean` in all subdirectories that contains `Cargo.toml`.
# This is important after `rustup update`!

set -euE
IFS=$'\n\t'

clean() {
    echo "+ $1"
    cargo clean --manifest-path "$1"
}

for toml in $(fd -a Cargo.toml) ; do
    clean "$toml" &
done

wait

